<!DOCTYPE html>
<html>
	<head>
		<script src="./jquery-3.4.1.slim.min.js"></script>
		<script type="text/javascript" src="./app.js"></script>
		<link rel="stylesheet" type="text/css"  href="style.css" /> 
	</head>


		<!-- **************SCRIPTS ************ -->

		<script type="text/javascript"> 
			//globals
			let pages = {}				//dictionary for all the pages		
			let users = []				// { username: string, password: string }
			
			//init
			$(document).ready(function(){
				//init buttons
				$("#login_button").click(function() {displayPage('login')})
				$("#register_button").click(function() {displayPage('register')})

				$("#nav_welcome_button").click(function() {displayPage('welcome')})
				$("#nav_register_button").click(function() {displayPage('register')})
				$("#nav_login_button").click(function() {displayPage('login')})
				$("#nav_about_button").click(function() {displayPage('about')})
				$("#nav_settings_button").click(function() {displayPage('settings')})
				$("#play_button").click(loginUser)

				$("#register_submit").click(registerUser)


				//init pages
				pages['welcome'] = $('#welcome_page')
				pages['login'] = $('#login_page')
				pages['register'] = $('#register_page')
				pages['about'] = $('#about_page')
				pages['settings'] = $('#settings_page')
				pages['game'] = $('#game')

				//init users
				users.push({username: "p", password: "p"})
			});

			//hides all pages except the one that is named
			function displayPage(name /*string*/) {
				for (let key in pages) {
					// check if the property/key is defined in the object itself, not in parent
					if (pages.hasOwnProperty(key)) {           
						pages[key].hide()
					}
				}	
				let pageToShow = pages[name]
				if(pageToShow)	{
					pageToShow.show()
				}				
			}

			//************** REGISTER ************
			function registerUser() {
				let fname = $('#fname').val()
				let username = $('#username').val()
				let password = $('#password').val()
				let email = $('#email').val()
				let date = $('#date').val()

				if(checkRegisterInput(fname, username, password, email, date)) {
					if(users.find(u => u.username === username)){
						window.alert("Username already exists!")
					} else {
						users.push({username: username, password: password})
						window.alert("User registered!")
					}
				}
			}

			function checkRegisterInput(fname, username, password, email, date) {
				if(fname === "" || username === "" || password === "" || email === "" || date === "") {
					return false
				}

				if(!checkFullName(fname) || !checkUserName(username) || !checkPassword(password) || !checkMail(email)) {
					return false
				}
				return true
			}

			function checkFullName(fname) {
				if(fname.match(/\d/g)){
					window.alert("Full name cannot contain digits")
					return false
				}
				return true
			}

			function checkUserName(username) {
				return true
			}

			function checkPassword(password) {
				if(password.length < 6){
					window.alert("Password must be more than 5 characters")
					return false
				}
				if(!password.match(/^[0-9a-zA-Z]+$/)){
					window.alert("Password can only contain letters and numbers")
					return false
				}
				return true
			}

			function checkMail(email) {
				if(!email.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)){
					window.alert("Mail is incorrect format")
					return false
				}
				return true
			}



			//************** LOGIN ************
			function loginUser() {
				let username = $('#login_username').val()
				let password = $('#login_password').val()
				let user = users.find(function(u) {
						return u.username === username
					})
				if(user) {
					if(user.password === password) {
						displayPage('game')
					}
					else {
						window.alert("Wrong password")
					}
				}
				else {
					window.alert("User doesn't exist")
				}
			}

		</script>



	<body>

		<header>
			<h1>Game Logo</h1>
		</header>


		<nav>
			<div id="nav_list">
				<br><br><br>
				<button id="nav_welcome_button" type="button" >Welcome</button>
				<br><br><br>
				<button id="nav_login_button" type="button" >Login</button>
				<br><br><br>
				<button id="nav_register_button" type="button" >Register</button>
				<br><br><br>
				<button id="nav_settings_button" type="button" >Settings</button>
				<br><br><br>
				<button id="nav_about_button" type="button" >About</button>
			</div>
		</nav>


		<section>

			<!-- WELCOME PAGE -->
			<div id="welcome_page">
				Welcome to Pacman!
				<button id="login_button" type="button" >Login</button>
				<button id="register_button" type="button" >Register</button>
			</div>

			<!-- REGISTER PAGE -->
			<div id="register_page" style="display: none;">
				TODO:
				<form>
					<label for="fname">Full Name:</label><br>
					<input type="text" id="fname" name="fname"><br>
					
					<label for="username">User Name:</label><br>
					<input type="text" id="username" name="uname"><br>

					<label for="password">Password:</label><br>
					<input type="password" id="password" name="pass"><br>

					<label for="email">E-mail:</label><br>
					<input type="text" id="email" name="mail"><br>

					<label for="date of birth">Date of Birth:</label><br>
					<input type="date" id="date" name="trip-start"
							value="1990-01-01"
							min="1900-01-01" max="2020-12-12">

					<button id="register_submit" type="button" >Submit</button>
				</form>
			</div>

			<!-- LOGIN PAGE -->
			<div id="login_page" style="display: none;">
				<label for="username">User Name:</label><br>
				<input type="text" id="login_username" name="uname"><br>

				<label for="password">Password:</label><br>
				<input type="password" id="login_password" name="pass"><br>
				<button id="play_button" type="button" >Login & Play!</button>
			</div>

			<!-- ABOUT PAGE -->
			<div id="about_page" style="display: none;">
				TODO:
			</div>

			<!-- SETTINGS PAGE -->
			<div id="settings_page" style="display: none;">
				TODO:
			</div>

			<!-- GAME PAGE -->
			<div id="game" style="display: none;">
				<div id="score">
					<label for="lblScore">SCORE:</label>
					<input id="lblScore" type="text" />
				</div>
				<div id="time">
					<label for="lblTime">TIME:</label>
					<input id="lblTime" type="text" />
				</div>
				<canvas id="canvas" height="600" width="600"></canvas>
			</div>
		</section>

		<footer>
			<h1>Footer TODO</h1>
		</footer>

	</body>
</html>
